#!/bin/sh

mode="$1"
if [ "$mode" = "mic" ]; then
    volume=$(wpctl get-volume @DEFAULT_AUDIO_SOURCE@)
    percent=$(echo "$volume" | awk '{print $2}')
    percent=$(echo "( $percent * 100 ) / 1" | bc)
    icon=""

    if echo "$volume" | grep -q 'MUTED'; then
        icon="󰍭"
    elif [ "$percent" -eq 0 ]; then
        icon=""
    elif [ "$percent" -le 30 ]; then
        icon=""
    fi

elif [ "$mode" = "backlight" ]; then
    # brightness notification
    brightness=$(brightnessctl get)
    max_brightness=$(brightnessctl max)
    percent=$(( brightness * 100 / max_brightness ))
    icon="󰃠"

    if [ $percent -le 20 ]; then
        icon="󰃞"
    elif [ $percent -le 60 ]; then
        icon="󰃟"
    fi

elif [ "$mode" = "vol" ]; then    
    volume=$(wpctl get-volume @DEFAULT_AUDIO_SINK@)
    percent=$(echo "$volume" | awk '{print $2}')
    percent=$(echo "( $percent * 100 ) / 1" | bc)
    icon=""

    # Check if the audio is muted
    if echo "$volume" | grep -q 'MUTED'; then
        icon=""
    elif [ "$percent" -eq 0 ]; then
        icon=""
    elif [ "$percent" -le 30 ]; then
        icon=""
    fi

else
    echo "Uses notify-send to show OSD for volume, mic mute, and backlight changes."
    echo "Usage: {mic|vol|backlight}"
    echo "Ex. notify-osd vol"
    echo ""
    exit 1
fi

notify-send -t 1000 -a 'notify-osd' -h int:value:$percent "${icon}  ${percent}% "
